<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
    <title>《React进阶指南》笔记 | 2333Ge</title>
    <link rel="shortcut icon" href="/logo.jpg"/>
    <meta name="generator" content="VuePress 1.9.7"/>
    
    <meta name="description" content="一个95后程序猿的学习小站">
    
    <link rel="preload" href="/docs/assets/css/0.styles.7e878f7b.css" as="style"><link rel="preload" href="/docs/assets/js/app.90fe924d.js" as="script"><link rel="preload" href="/docs/assets/js/4.2437bced.js" as="script"><link rel="preload" href="/docs/assets/js/12.f6f8b844.js" as="script"><link rel="preload" href="/docs/assets/js/6.b41b8e83.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.f141d789.js"><link rel="prefetch" href="/docs/assets/js/11.3b8dd561.js"><link rel="prefetch" href="/docs/assets/js/13.ce5c32bf.js"><link rel="prefetch" href="/docs/assets/js/14.27b64ded.js"><link rel="prefetch" href="/docs/assets/js/15.16b5b255.js"><link rel="prefetch" href="/docs/assets/js/16.e53483ab.js"><link rel="prefetch" href="/docs/assets/js/17.3a59b2eb.js"><link rel="prefetch" href="/docs/assets/js/18.da250b71.js"><link rel="prefetch" href="/docs/assets/js/19.aca309b2.js"><link rel="prefetch" href="/docs/assets/js/20.17dd5352.js"><link rel="prefetch" href="/docs/assets/js/21.b2688e48.js"><link rel="prefetch" href="/docs/assets/js/22.7ab37c33.js"><link rel="prefetch" href="/docs/assets/js/23.504fd4ac.js"><link rel="prefetch" href="/docs/assets/js/24.38be6b09.js"><link rel="prefetch" href="/docs/assets/js/25.d0a07e8c.js"><link rel="prefetch" href="/docs/assets/js/26.a5354581.js"><link rel="prefetch" href="/docs/assets/js/27.924641e4.js"><link rel="prefetch" href="/docs/assets/js/28.27390168.js"><link rel="prefetch" href="/docs/assets/js/29.4697b4c0.js"><link rel="prefetch" href="/docs/assets/js/30.cf22cd58.js"><link rel="prefetch" href="/docs/assets/js/31.a78592d9.js"><link rel="prefetch" href="/docs/assets/js/32.dc14ff68.js"><link rel="prefetch" href="/docs/assets/js/33.8b5e7857.js"><link rel="prefetch" href="/docs/assets/js/34.e0b2dcc5.js"><link rel="prefetch" href="/docs/assets/js/35.5839ecc7.js"><link rel="prefetch" href="/docs/assets/js/36.1fdf5604.js"><link rel="prefetch" href="/docs/assets/js/37.3b220328.js"><link rel="prefetch" href="/docs/assets/js/38.66788129.js"><link rel="prefetch" href="/docs/assets/js/39.933c024e.js"><link rel="prefetch" href="/docs/assets/js/40.f5e0ea38.js"><link rel="prefetch" href="/docs/assets/js/41.b010eed6.js"><link rel="prefetch" href="/docs/assets/js/42.3a3c2310.js"><link rel="prefetch" href="/docs/assets/js/43.7db302a1.js"><link rel="prefetch" href="/docs/assets/js/44.97826806.js"><link rel="prefetch" href="/docs/assets/js/45.264c1125.js"><link rel="prefetch" href="/docs/assets/js/46.c0fc0ad0.js"><link rel="prefetch" href="/docs/assets/js/47.0c3428ca.js"><link rel="prefetch" href="/docs/assets/js/48.e0fad1ac.js"><link rel="prefetch" href="/docs/assets/js/49.9628939b.js"><link rel="prefetch" href="/docs/assets/js/5.6309798a.js"><link rel="prefetch" href="/docs/assets/js/50.af2d54f6.js"><link rel="prefetch" href="/docs/assets/js/51.f4d65a93.js"><link rel="prefetch" href="/docs/assets/js/52.73373cf1.js"><link rel="prefetch" href="/docs/assets/js/53.06a8ed65.js"><link rel="prefetch" href="/docs/assets/js/54.743acf25.js"><link rel="prefetch" href="/docs/assets/js/55.92d1347d.js"><link rel="prefetch" href="/docs/assets/js/56.84e19f1f.js"><link rel="prefetch" href="/docs/assets/js/57.56206fc3.js"><link rel="prefetch" href="/docs/assets/js/7.5627ef7d.js"><link rel="prefetch" href="/docs/assets/js/8.b7166236.js"><link rel="prefetch" href="/docs/assets/js/9.0731487e.js"><link rel="prefetch" href="/docs/assets/js/vendors~flowchart.b9a9f3ba.js"><link rel="prefetch" href="/docs/assets/js/vuejs-paginate.2864cecd.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.7e878f7b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><div class="theme-sidebar"><div class="theme-sidebar__inner"><div class="theme-header"><a href="/docs/" class="theme-header__logo router-link-active"><img draggable="false" src="./logo.jpg" alt="logo" width="160" height="160" class="theme-header__picture"> <div class="theme-palette"><span class="theme-palette__emoji"><svg class="theme-icon theme-icon-palette"><use xlink:href="#theme-icon-palette"></use></svg></span> <div class="theme-palette__list"><a href="javascript:;" title="#673ab7" style="color:#673ab7;"></a><a href="javascript:;" title="#3f51b5" style="color:#3f51b5;"></a><a href="javascript:;" title="#2196f3" style="color:#2196f3;"></a><a href="javascript:;" title="#009688" style="color:#009688;"></a><a href="javascript:;" title="#4caf50" style="color:#4caf50;"></a><a href="javascript:;" title="#ff9800" style="color:#ff9800;"></a><a href="javascript:;" title="#ff5722" style="color:#ff5722;"></a><a href="javascript:;" title="#795548" style="color:#795548;"></a><a href="javascript:;" title="#607D8B" style="color:#607D8B;"></a><a href="javascript:;" title="#2a2b33" style="color:#2a2b33;"></a></div></div></a> <a href="/docs/" class="theme-header__name router-link-active">
        2333Ge
      </a> <p class="theme-header__slogan">一个95后程序猿的学习小站</p></div> <div class="theme-SubNav"><a href="/docs/archives/" class="theme-SubNav__item"><span class="theme-SubNav__count">47</span> <span class="theme-SubNav__name">Archives</span></a> <a href="/docs/categories/" class="theme-SubNav__item"><span class="theme-SubNav__count">19</span> <span class="theme-SubNav__name">Categories</span></a> <a href="/docs/tags/" class="theme-SubNav__item"><span class="theme-SubNav__count">25</span> <span class="theme-SubNav__name">Tags</span></a></div> <div class="theme-nav"><div class="search-box mt-7"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">
  🏠 主页
</a></div> <!----></nav></div> <div class="theme-footer"><div class="social-links"><a target="_blank" rel="external nofollow noopener" title="email" href="mailto:ych.class@qq.com" class="icon-email">email</a><a target="_blank" rel="external nofollow noopener" title="github" href="https://github.com/2333Ge" class="icon-github">github</a></div> <p class="copyright"></p> <p class="powered"><span>Powered by <a href="https://vuepress.vuejs.org" target="_blank" rel="external nofollow noopener">VuePress</a></span> <span class="φde"> Theme - <a href="https://github.com/80maker/vuepress-theme-maker" target="_blank" rel="external nofollow noopener">Maker</a></span></p></div></div></div> <div class="theme-main"><div class="theme-main__inner post"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting"><header class="article__header"><h1 itemprop="name headline" class="post-title">
          《React进阶指南》笔记
        </h1> <div class="post-meta"><!----> <div class="post-meta__date"><i class="icon-calendar"></i> <time pubdate itemprop="datePublished" datetime="2022-04-02T00:00:00.000Z">
      Apr 02, 2022
    </time></div> <div class="post-meta__cates"><i class="icon-cate"></i> <a href="/docs/categories/React/">
      React
    </a></div> <div class="post-meta__reading"><i class="icon-time"></i>
    3.5k words in 13 min
  </div> <div id="" data-flag-title="Your Article Title" class="leancloud_visitors"><i class="icon-eye"></i> <i class="leancloud-visitors-count">--</i></div></div></header> <div class="article-con"><div itemprop="articleBody" class="article-content content__default copy-code-enabled"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <blockquote><p>原文：<a href="https://juejin.cn/book/6945998773818490884" target="_blank" rel="noopener noreferrer">《React 进阶指南》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
个人 demo: demo/react-demo</p></blockquote> <p>源码下载：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">git</span> clone https://hub.fastgit.org/facebook/react.git
<span class="token function">git</span> checkout v16.19
</code></pre></div><h2 id="认识-jsx"><a href="#认识-jsx" class="header-anchor">#</a> 认识 JSX</h2> <h3 id="jsx-被-react-处理成什么"><a href="#jsx-被-react-处理成什么" class="header-anchor">#</a> JSX 被 React 处理成什么</h3> <div class="language- extra-class"><pre class="language-text"><code>const toLearn = [ 'react' , 'vue' , 'webpack' , 'nodejs'  ]

const TextComponent = ()=&gt; &lt;div&gt; hello , i am function component &lt;/div&gt;

class Index extends React.Component{
    status = false /* 状态 */
    renderFoot=()=&gt; &lt;div&gt; i am foot&lt;/div&gt;
    render(){
        /* 以下都是常用的jsx元素节 */
        return &lt;div style={{ marginTop:'100px' }}   &gt;
            { /* element 元素类型 */ }
            &lt;div&gt;hello,world&lt;/div&gt;
            { /* fragment 类型 */ }
            &lt;React.Fragment&gt;
                &lt;div&gt; 👽👽 &lt;/div&gt;
            &lt;/React.Fragment&gt;
            { /* text 文本类型 */ }
            my name is alien
            { /* 数组节点类型 */ }
            { toLearn.map(item=&gt; &lt;div key={item} &gt;let us learn { item } &lt;/div&gt; ) }
            { /* 组件类型 */ }
            &lt;TextComponent/&gt;
            { /* 三元运算 */  }
            { this.status ? &lt;TextComponent /&gt; : &lt;div&gt;三元运算&lt;/div&gt; }
            { /* 函数执行 */ }
            { this.renderFoot() }
            &lt;button onClick={ ()=&gt; console.log( this.render() ) } &gt;打印render后的内容&lt;/button&gt;
        &lt;/div&gt;
    }
}
</code></pre></div><ol><li>babel 编译：React.createElement, 注意 3 个参数作用
<img src="/docs/assets/img/JSX-babel.2bd77664.jpg" alt="图片"></li> <li>createElement 处理后的样子 注意转换类型的映照关系
<img src="/docs/assets/img/jsx-creatElement.516f32d7.jpg" alt="图片"></li> <li>React 底层调和处理后，终将变成什么？
React element 对象的每一个子节点都会形成一个与之对应的 fiber 对象，然后通过 sibling、return、child 将每一个 fiber 对象联系起来。</li></ol> <h3 id="react-api"><a href="#react-api" class="header-anchor">#</a> React API</h3> <ul><li>React.Children.toArray，扁平化，规范化 children 数组</li> <li>React.Children.forEach，遍历 children，内部已扁平化 children</li> <li>React.createElement</li> <li>react.cloneElement</li></ul> <h3 id="qa"><a href="#qa" class="header-anchor">#</a> QA</h3> <ol><li>老版本的 React 中，为什么写 jsx 的文件要默认引入 React</li></ol> <div class="language- extra-class"><pre class="language-text"><code>import React from 'react'
function Index(){
    return &lt;div&gt;hello,world&lt;/div&gt;
}
</code></pre></div><p>答：因为 jsx 在被 babel 编译后，写的 jsx 会变成上述 React.createElement 形式，所以需要引入 React，防止找不到 React 引起报错。</p> <h2 id="component"><a href="#component" class="header-anchor">#</a> Component</h2> <p>可通过原型链的方式给类增加默认操作</p> <div class="language- extra-class"><pre class="language-text"><code>class Index extends React.Component{
    constructor(...arg){
       super(...arg)                        /* 执行 react 底层 Component 函数 */
    }
    state = {}                              /* state */
    static number = 1                       /* 内置静态属性 */
    componentDidMount(){                    /* 生命周期 */
        console.log(Index.number,Index.number1) // 打印 1 , 2
    }
    render(){                               /* 渲染函数 */
        return &lt;div style={{ marginTop:'50px' }} onClick={ this.handerClick }  &gt;hello,React!&lt;/div&gt;
    }
}
Index.number1 = 2                           /* 外置静态属性 */
Index.prototype.handleClick = ()=&gt; console.log(222) /* 方法: 绑定在 Index 原型链的 方法*/
</code></pre></div><p>组件的继承：state 和生命周期会被继承后的组件修改。像下列 demo 中，Person 组件中的 componentDidMount 生命周期将不会被执行。</p> <div class="language- extra-class"><pre class="language-text"><code>/* 人类 */
class Person extends React.Component{
    constructor(props){
        super(props)
        console.log('hello , i am person')
    }
    componentDidMount(){ console.log(1111)  }
    eat(){    /* 吃饭 */ }
    sleep(){  /* 睡觉 */  }
    ddd(){   console.log('打豆豆')  /* 打豆豆 */ }
    render(){
        return &lt;div&gt;
            大家好，我是一个person
        &lt;/div&gt;
    }
}
/* 程序员 */
class Programmer extends Person{
    constructor(props){
        super(props)
        console.log('hello , i am Programmer too')
    }
    componentDidMount(){  console.log(this)  }
    code(){ /* 敲代码 */ }
    render(){
        return &lt;div style={ { marginTop:'50px' } } &gt;
            { super.render() } { /* 让 Person 中的 render 执行 */ }
            我还是一个程序员！    { /* 添加自己的内容 */ }
        &lt;/div&gt;
    }
}
export default Programmer
</code></pre></div><p>类组件和函数组件的区别：</p> <ol><li>类组件的本质就是 类和函数还有 oop 思想中的继承，在此之上需要内置处理 state 和 props 组件的状态维护，状态 -&gt; ui -&gt; 渲染</li> <li>函数组件 没有实例化的概念，FP 思想，每个组件应该只处理一个逻辑事物不想 class 组件那么复合，另外它没有转态存储能力必须依赖 hook</li></ol> <h3 id="state"><a href="#state" class="header-anchor">#</a> State</h3> <p>组件初始化过程中绑定了负责更新的 Updater 对象，对于如果调用 setState 方法，实际上是 React 底层调用 Updater 对象上的 enqueueSetState 方法。</p> <h4 id="类组件"><a href="#类组件" class="header-anchor">#</a> 类组件</h4> <p><strong>unstable_batchedUpdates</strong>:异步环境下，继开启批量更新模式</p> <div class="language- extra-class"><pre class="language-text"><code>setTimeout(()=&gt;{
    unstable_batchedUpdates(()=&gt;{
        this.setState({ number:this.state.number + 1 })
        console.log(this.state.number)
        this.setState({ number:this.state.number + 1})
        console.log(this.state.number)
        this.setState({ number:this.state.number + 1 })
        console.log(this.state.number)
    })
})
</code></pre></div><p><strong>flushSync</strong>:提升更新优先级</p> <div class="language- extra-class"><pre class="language-text"><code>handerClick=()=&gt;{
    setTimeout(()=&gt;{
        this.setState({ number: 1  })
    })
    this.setState({ number: 2  })
    ReactDOM.flushSync(()=&gt;{
        this.setState({ number: 3  })
    })
    this.setState({ number: 4  })
}
render(){
   console.log(this.state.number)
   return ...
}
</code></pre></div><h4 id="函数组件"><a href="#函数组件" class="header-anchor">#</a> 函数组件</h4> <div class="language- extra-class"><pre class="language-text"><code>[ ①state , ②dispatch ] = useState(③initData)
</code></pre></div><ul><li>注意 ② ③ 是函数的情况</li></ul> <h4 id="qa-2"><a href="#qa-2" class="header-anchor">#</a> QA</h4> <ol><li>为什么异步环境中批量更新规则被打破， setState 后走 render??????宏微任务</li> <li>useState 参数可以是个函数，初始值是函数执行后的结果？</li> <li>RN 没有 ReactDOM.flushSync</li> <li>legacy 模式，还有 blocking 模式、concurrent 模式概念</li> <li>（图）合并 state 和调和树的顺序是否应该反过来</li> <li>合并 state 的过程在哪儿</li> <li>下列点击事件的打印结果</li> <li>宏任务微任务？js 任务系统</li> <li>useState 初始化对象是一个复杂对象的情况，改变初始对象，useState 的对象会改变吗</li></ol> <div class="language- extra-class"><pre class="language-text"><code>handleClick= () =&gt; {
          this.setState({ number:this.state.number + 1 },()=&gt;{   console.log( 'callback1', this.state.number)  })
          console.log(this.state.number)
          this.setState({ number:this.state.number + 2 },()=&gt;{   console.log( 'callback2', this.state.number)  })
          console.log(this.state.number)
          this.setState({ number:this.state.number + 3 },()=&gt;{   console.log( 'callback3', this.state.number)  })
          console.log(this.state.number)
    }
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>0, 0, 0, callback1 3 ,callback2 3 ,callback3 3
</code></pre></div><h3 id="自定义-hooks"><a href="#自定义-hooks" class="header-anchor">#</a> 自定义 Hooks</h3> <h4 id="qa-3"><a href="#qa-3" class="header-anchor">#</a> QA</h4> <ul><li>执行副作用、demo 好像有问题，敲一个</li></ul> <h2 id="随记"><a href="#随记" class="header-anchor">#</a> 随记</h2> <ul><li>扁平化的意思？树形结构如何扁平化</li> <li>fiber 对象</li></ul> <h2 id="深入-props"><a href="#深入-props" class="header-anchor">#</a> 深入 props</h2> <h3 id="props-操作技巧"><a href="#props-操作技巧" class="header-anchor">#</a> props 操作技巧</h3> <p>抽象 Props 一般用于<strong>跨层级传递 props</strong>，一般不需要具体指出 props 中某个属性，而是将 props 直接传入或者是抽离到子组件中</p> <h4 id="混入-props"><a href="#混入-props" class="header-anchor">#</a> 混入 props</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Son</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> hello<span class="token punctuation">,</span>world <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Father</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> fatherProps <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mes</span><span class="token operator">:</span> <span class="token string">&quot;let us learn React !&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>Son <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>fatherProps<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> indexProps <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;alien&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token string">&quot;28&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>Father <span class="token punctuation">{</span><span class="token operator">...</span>indexProps<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>打印
<img src="/docs/assets/img/props-to.e4950e4a.jpg" alt="图片">
将 Index 组件 indexProps 抽象传递给 Son，一方面混入 fatherProps</p> <h4 id="抽离-props"><a href="#抽离-props" class="header-anchor">#</a> 抽离 props</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Son</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> hello<span class="token punctuation">,</span>world <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Father</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> age<span class="token punctuation">,</span> <span class="token operator">...</span>fatherProps <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>Son <span class="token punctuation">{</span><span class="token operator">...</span>fatherProps<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> indexProps <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;alien&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token string">&quot;28&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">mes</span><span class="token operator">:</span> <span class="token string">&quot;let us learn React !&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>Father <span class="token punctuation">{</span><span class="token operator">...</span>indexProps<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>将 indexProps 中的 age 属性抽离出来。</p> <h4 id="隐式注入-props"><a href="#隐式注入-props" class="header-anchor">#</a> 隐式注入 props</h4> <p>React.cloneElement</p> <h4 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h4> <ul><li>对 props 中 children 的操作，显示与否、判断类型做自己的渲染逻辑等</li> <li>对 props 中的 children 的 props 操作，注入新的 props 等</li></ul> <p>容器技巧 =&gt; 获取 children =&gt; 做自定义操作</p> <h4 id="qa-4"><a href="#qa-4" class="header-anchor">#</a> QA</h4> <p>FormItem.displayName 为什么这么取 children.type.displayName</p> <h2 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h2> <ul><li>挂载
<img src="/docs/assets/img/lifecycle-mont.24fff6e1.jpg" alt="图片"></li></ul> <p>constructor -&gt; getDerivedStateFromProps / componentWillMount -&gt; render -&gt; componentDidMount</p> <ul><li>更新
<img src="/docs/assets/img/lifecycle-update.090326d6.jpg" alt="图片"></li></ul> <p>componentWillReceiveProps( props 改变) / getDerivedStateFromProp -&gt; shouldComponentUpdate -&gt; componentWillUpdate -&gt; render -&gt; getSnapshotBeforeUpdate -&gt; componentDidUpdate</p> <ul><li><p>销毁
commit 阶段调用 componentWillUnmount</p></li> <li><p>总览
<img src="/docs/assets/img/lifecycle-all-class.5860a3e1.jpg" alt="图片"></p></li></ul> <h3 id="各阶段要点"><a href="#各阶段要点" class="header-anchor">#</a> 各阶段要点</h3> <ul><li>getDerivedStateFromProps：只是静态方法、访问不到 this，组件更新，就会执行 getDerivedStateFromProps，不管是 props 改变，还是 setState ，或是 forceUpdate 。</li> <li>getSnapshotBeforeUpdate: 获取 更新前 DOM 信息的最佳时期，getSnapshotBeforeUpdate 将返回一个值作为一个 snapShot(快照)，传递给 componentDidUpdate 作为第三个参数</li></ul> <h2 id="context"><a href="#context" class="header-anchor">#</a> context</h2> <h3 id="consumer-的三种写法"><a href="#consumer-的三种写法" class="header-anchor">#</a> consumer 的三种写法</h3> <ul><li>useContext</li> <li>函数式</li> <li>contextType</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">const</span> ThemeContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 类组件 - contextType 方式</span>
<span class="token keyword">class</span> <span class="token class-name">ConsumerDemo</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> color<span class="token punctuation">,</span> background <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> color<span class="token punctuation">,</span> background <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">消费者</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
ConsumerDemo<span class="token punctuation">.</span>contextType <span class="token operator">=</span> ThemeContext<span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Son</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ConsumerDemo</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span>
</code></pre></div><h3 id="provider-特性"><a href="#provider-特性" class="header-anchor">#</a> Provider 特性</h3> <ol><li>Provider 作为提供者传递 context ，provider 中 value 属性改变会使所有消费 context 的组件重新更新。</li> <li>Provider 可以逐层传递 context，下一层 Provider 会覆盖上一层 Provider。</li></ol> <h3 id="qa-5"><a href="#qa-5" class="header-anchor">#</a> QA</h3> <ul><li>contextType 底层如何处理的</li></ul> <h3 id="拓展"><a href="#拓展" class="header-anchor">#</a> 拓展</h3> <ul><li>注意其中的例子：Provider value 改变 导致组件树重新渲染的例子
<blockquote><p>没有 memo 处理，useState 会让 ProviderDemo 重新 render ，此时 son 没有处理，就会跟随父组件 render</p></blockquote></li></ul> <h2 id="高阶组件"><a href="#高阶组件" class="header-anchor">#</a> 高阶组件</h2> <p>高阶组件能复用哪些代码逻辑？</p> <ul><li>渲染劫持：懒加载、动态加载、渲染与否、统一空展示、统一异常展示、替换节点等</li> <li>混入 Props: 新增 props,传递已知 props 值，比如项目中想让一个非 Route 组件，也能通过 props 获取路由实现跳转，但是不想通过父级路由组件层层绑定 props ，这个时候就需要一个 HOC 把改变路由的 history 对象混入 props 中，于是 withRoute 诞生了。</li> <li>监控组件内部状态：如对组件内的点击事件做一些监控，或者加一次额外的生命周期，对现有 props 做一些加工重新传递</li></ul> <p>两种不同的高阶组件</p> <ul><li>属性代理：无侵入、多层嵌套比较安全、低耦合，注意处理 Ref、静态属性</li> <li>反向继承：便于绑定生命周期，无需处理 Ref、静态属性，多个反向继承会相互覆盖，耦合较高，需要知道原始组件</li></ul> <h3 id="示例代码"><a href="#示例代码" class="header-anchor">#</a> 示例代码</h3> <ol><li>强化 props</li></ol> <p>加入一些其他的 props ，强化原始组件功能</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 让组件也可以获取到路由对象，进行路由跳转等操作</span>
<span class="token keyword">function</span> <span class="token function">withRouter</span><span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> displayName <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">withRouter(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Component<span class="token punctuation">.</span>displayName <span class="token operator">||</span> Component<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">C</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">/*  获取 */</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> wrappedComponentRef<span class="token punctuation">,</span> <span class="token operator">...</span>remainingProps <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>RouterContext<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>Component
              <span class="token punctuation">{</span><span class="token operator">...</span>remainingProps<span class="token punctuation">}</span> <span class="token comment">// 组件原始的props</span>
              <span class="token punctuation">{</span><span class="token operator">...</span>context<span class="token punctuation">}</span> <span class="token comment">// 存在路由对象的上下文，history  location 等</span>
              ref<span class="token operator">=</span><span class="token punctuation">{</span>wrappedComponentRef<span class="token punctuation">}</span>
            <span class="token operator">/</span><span class="token operator">&gt;</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>RouterContext<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token constant">C</span><span class="token punctuation">.</span>displayName <span class="token operator">=</span> displayName<span class="token punctuation">;</span>
  <span class="token constant">C</span><span class="token punctuation">.</span>WrappedComponent <span class="token operator">=</span> Component<span class="token punctuation">;</span>
  <span class="token comment">/* 继承静态属性 */</span>
  <span class="token keyword">return</span> <span class="token function">hoistStatics</span><span class="token punctuation">(</span><span class="token constant">C</span><span class="token punctuation">,</span> Component<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> withRouter<span class="token punctuation">;</span>
</code></pre></div><h3 id="注意事项"><a href="#注意事项" class="header-anchor">#</a> 注意事项</h3> <ol><li>不要在函数组件内部或类组件 render 函数中使用 HOC</li></ol> <p>每一次类组件触发 render 或者函数组件执行都会产生一个新的 WrapHome，react diff 会判定两次不是同一个组件，那么就会卸载老组件，重新挂载新组件，造成新能浪费</p> <ol start="2"><li>处理 Ref</li> <li>处理静态属性</li> <li>多 HOC 时 注意是否会相互影响</li></ol> <h2 id="渲染控制"><a href="#渲染控制" class="header-anchor">#</a> 渲染控制</h2> <p>useMemo 原理：useMemo 会记录上一次执行 create 的返回值，并把它绑定在函数组件对应的 fiber 对象上，只要组件不销毁，缓存值就一直存在，但是 deps 中如果有一项改变，就会重新执行 create ，返回值作为新的值记录到 fiber 对象上</p> <p>注意给组件 props 传箭头函数、对象的情况，会使 PureComponent 失效</p> <p>React.memo 当二个参数 compare 不存在时，会用浅比较原则处理 props ，相当于仅比较 props 版本的 pureComponent</p> <p>打破渲染限制：</p> <ol><li><p>forceUpdate。类组件更新如果调用的是 forceUpdate 而不是 setState ，会跳过 PureComponent 的浅比较和 shouldComponentUpdate 自定义比较。其原理是组件中调用 forceUpdate 时候，全局会开启一个 hasForceUpdate 的开关。当组件更新的时候，检查这个开关是否打开，如果打开，就直接跳过 shouldUpdate 。</p></li> <li><p>context 穿透，上述的几种方式，都不能本质上阻断 context 改变，而带来的渲染穿透，所以开发者在使用 Context 要格外小心，既然选择了消费 context ，就要承担 context 改变，带来的更新作用。</p></li></ol> <p>渲染流程图
<img src="/docs/assets/img/render-step.09225c1d.jpg" alt="图片"></p> <h2 id="事件原理"><a href="#事件原理" class="header-anchor">#</a> 事件原理</h2> <ul><li>阻止冒泡：React 中如果想要阻止事件向上冒泡，可以用 e.stopPropagation()</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* 阻止事件冒泡，handleFatherClick 事件讲不在触发 */</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">handleFatherClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;冒泡到父级&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleFatherClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>点击<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="fiber"><a href="#fiber" class="header-anchor">#</a> Fiber</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">FiberNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>tag <span class="token operator">=</span> tag<span class="token punctuation">;</span> <span class="token comment">// fiber 标签 证明是什么类型fiber。</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span> <span class="token comment">// key调和子节点时候用到。</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// dom元素是对应的元素类型，比如div，组件指向组件对应的类或者函数。</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>stateNode <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 指向对应的真实dom元素，类组件指向组件实例，可以被ref获取。</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>return <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 指向父级fiber</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>child <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 指向子级fiber</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>sibling <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 指向兄弟fiber</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 索引</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>ref <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// ref指向，ref函数，或者ref对象。</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>pendingProps <span class="token operator">=</span> pendingProps<span class="token punctuation">;</span> <span class="token comment">// 在一次更新中，代表element创建</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>memoizedProps <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 记录上一次更新完毕后的props</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>updateQueue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 类组件存放setState更新队列，函数组件存放</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 类组件保存state信息，函数组件保存hooks信息，dom元素为null</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>dependencies <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// context或是时间的依赖项</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>mode <span class="token operator">=</span> mode<span class="token punctuation">;</span> <span class="token comment">//描述fiber树的模式，比如 ConcurrentMode 模式</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>effectTag <span class="token operator">=</span> NoEffect<span class="token punctuation">;</span> <span class="token comment">// effect标签，用于收集effectList</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>nextEffect <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 指向下一个effect</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>firstEffect <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 第一个effect</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>lastEffect <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 最后一个effect</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>expirationTime <span class="token operator">=</span> NoWork<span class="token punctuation">;</span> <span class="token comment">// 通过不同过期时间，判断任务是否过期， 在v17版本用lane表示。</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>alternate <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">//双缓存树，指向缓存的fiber。更新阶段，两颗树互相交替。</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="render-commit"><a href="#render-commit" class="header-anchor">#</a> render &amp; commit</h3> <h4 id="render"><a href="#render" class="header-anchor">#</a> render</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// react-reconciler/src/ReactFiberWorkLoop.js</span>

<span class="token keyword">function</span> <span class="token function">workLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>workInProgress <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    workInProgress <span class="token operator">=</span> <span class="token function">performUnitOfWork</span><span class="token punctuation">(</span>workInProgress<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>调和过程中，每一个发生更新的 fiber 都会作为一次 workInProgress</p> <p>workLoop 就是执行每一个单元的调度器，如果渲染没有被中断，那么 workLoop 会遍历一遍 fiber 树</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// react-reconciler/src/ReactFiberWorkLoop.js</span>

<span class="token keyword">function</span> <span class="token function">performUnitOfWork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  next <span class="token operator">=</span> <span class="token function">beginWork</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> unitOfWork<span class="token punctuation">,</span> renderExpirationTime<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 按照 child 指针逐层向下调和，期间会执行函数组件，实例类组件，diff 调和子节点，打不同effectTag。</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    next <span class="token operator">=</span> <span class="token function">completeUnitOfWork</span><span class="token punctuation">(</span>unitOfWork<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 向上归并的过程，如果有兄弟节点，会返回 sibling兄弟，没有返回 return 父级，一直返回到 fiebrRoot ，期间可以形成effectList，对于初始化流程会创建 DOM ，对于 DOM 元素进行事件收集，处理style，className等。</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>总结 beginWork 作用如下：</p> <p>对于组件，执行部分生命周期，执行 render ，得到最新的 children 。
向下遍历调和 children ，复用 oldFiber ( diff 算法)，diff 流程在第十二章已经讲过了。
打不同的副作用标签 effectTag ，比如类组件的生命周期，或者元素的增加，删除，更新。</p> <p>completeUnitOfWork 的流程是自下向上的，那么 completeUnitOfWork 过程主要做写什么呢？</p> <p>首先 completeUnitOfWork 会将 effectTag 的 Fiber 节点会被保存在一条被称为 effectList 的单向链表中。在 commit 阶段，将不再需要遍历每一个 fiber ，只需要执行更新 effectList 就可以了。
completeWork 阶段对于组件处理 context ；对于元素标签初始化，会创建真实 DOM ，将子孙 DOM 节点插入刚生成的 DOM 节点中；会触发 diffProperties 处理 props ，比如事件收集，style，className 处理，在 15 章讲到过。</p> <h4 id="commit"><a href="#commit" class="header-anchor">#</a> commit</h4> <p>主要做的事就是执行 effectList，更新 DOM，执行生命周期，获取 ref 等操作</p> <h4 id="调和-异步调度-流程总图"><a href="#调和-异步调度-流程总图" class="header-anchor">#</a> 调和 + 异步调度 流程总图</h4> <p><img src="/docs/assets/img/fiber-async.95e78237.jpg" alt="图片"></p> <h3 id="question"><a href="#question" class="header-anchor">#</a> Question</h3> <ul><li>什么是 fiber ？</li> <li>Fiber 架构解决了什么问题？</li> <li>Fiber root 和 root fiber 有什么区别？</li> <li>不同 fiber 之间如何建立起关联的？</li> <li>React 调和流程？</li> <li>两大阶段 commit 和 render 都做了哪些事情？</li> <li>什么是双缓冲树？</li> <li>有什么作用？</li> <li>Fiber 深度遍历流程？</li> <li>Fiber 的调和能中断吗？</li> <li>如何中断？</li> <li>假设某个 5 层 Fiber 数已经创建完毕，3 层发生更新时，调和从什么地方开始调和</li> <li>element 和 Fiber 如何联系起来的</li></ul> <h2 id="hooks-原理"><a href="#hooks-原理" class="header-anchor">#</a> Hooks 原理</h2> <h3 id="questions"><a href="#questions" class="header-anchor">#</a> Questions</h3> <p>① React Hooks 为什么必须在函数组件内部执行？React 如何能够监听 React Hooks 在外部执行<br>
并抛出异常。<br>
② React Hooks 如何把状态保存起来？保存的信息存在了哪里？<br>
③ React Hooks 为什么不能写在条件语句中？<br>
④ useMemo 内部引用 useRef 为什么不需要添加依赖项，而 useState 就要添加依赖项。<br>
⑤ useEffect 添加依赖项 props.a ，为什么 props.a 改变，useEffect 回调函数 create 重<br>
新执行。<br>
⑥ React 内部如何区别 useEffect 和 useLayoutEffect ，执行时机有什么不同？</p> <h3 id=""><a href="#" class="header-anchor">#</a></h3> <h2 id="随记-2"><a href="#随记-2" class="header-anchor">#</a> 随记</h2> <ul><li>如何分享</li> <li>每章以后需要知道该章要点,相关问题面试时可能问到</li></ul></div> <div class="article-copyright"><ul><li class="article-copyright__item"><strong class="article-copyright__title">Last-updated<span>:</span></strong> <p class="article-copyright__text"></p></li> <li class="article-copyright__item"><strong class="article-copyright__title">Copyright<span>:</span></strong> <p class="article-copyright__text">自由转载-非商用-禁止演绎-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh">CC
                BY-NC-ND 4.0</a>）</p></li> <li class="article-copyright__item"><strong class="article-copyright__title">Link<span>:</span></strong> <p class="article-copyright__text"><a href="/post/2022/04/02/react-advanced-summary.html" title="《React进阶指南》笔记">/post/2022/04/02/react-advanced-summary.html</a></p></li></ul></div> <!----></div> <div class="article-footer"><ul class="post-tag"><li class="post-tag__item"><a href="/docs/tags/React"><span># React</span></a></li><li class="post-tag__item"><a href="/docs/tags/Reading"><span># Reading</span></a></li></ul> <div class="post-operate"><a href="/docs/post/2022/04/02/nodejs.html" class="post-operate__prev">Nodejs概览</a> <a href="/docs/post/2022/04/02/react-basic.html" class="post-operate__next">React语法基础</a></div> <!----></div></article></div></div> <svg style="display:none;"><symbol id="theme-icon-auto" viewBox="0 0 32 32"><path d="M16 0c-8.837 0-16 7.163-16 16s7.163 16 16 16 16-7.163 16-16-7.163-16-16-16zM4 16c0-6.627 5.373-12 12-12v24c-6.627 0-12-5.373-12-12z"></path></symbol> <symbol id="theme-icon-sun" viewBox="0 0 32 32"><path d="M16 26c1.105 0 2 0.895 2 2v2c0 1.105-0.895 2-2 2s-2-0.895-2-2v-2c0-1.105 0.895-2 2-2zM16 6c-1.105 0-2-0.895-2-2v-2c0-1.105 0.895-2 2-2s2 0.895 2 2v2c0 1.105-0.895 2-2 2zM30 14c1.105 0 2 0.895 2 2s-0.895 2-2 2h-2c-1.105 0-2-0.895-2-2s0.895-2 2-2h2zM6 16c0 1.105-0.895 2-2 2h-2c-1.105 0-2-0.895-2-2s0.895-2 2-2h2c1.105 0 2 0.895 2 2zM25.899 23.071l1.414 1.414c0.781 0.781 0.781 2.047 0 2.828s-2.047 0.781-2.828 0l-1.414-1.414c-0.781-0.781-0.781-2.047 0-2.828s2.047-0.781 2.828 0zM6.101 8.929l-1.414-1.414c-0.781-0.781-0.781-2.047 0-2.828s2.047-0.781 2.828 0l1.414 1.414c0.781 0.781 0.781 2.047 0 2.828s-2.047 0.781-2.828 0zM25.899 8.929c-0.781 0.781-2.047 0.781-2.828 0s-0.781-2.047 0-2.828l1.414-1.414c0.781-0.781 2.047-0.781 2.828 0s0.781 2.047 0 2.828l-1.414 1.414zM6.101 23.071c0.781-0.781 2.047-0.781 2.828 0s0.781 2.047 0 2.828l-1.414 1.414c-0.781 0.781-2.047 0.781-2.828 0s-0.781-2.047 0-2.828l1.414-1.414z"></path> <path d="M16 8c-4.418 0-8 3.582-8 8s3.582 8 8 8c4.418 0 8-3.582 8-8s-3.582-8-8-8zM16 21c-2.761 0-5-2.239-5-5s2.239-5 5-5 5 2.239 5 5-2.239 5-5 5z"></path></symbol> <symbol id="theme-icon-moon" viewBox="0 0 18 18"><path d="M7.246 3.255c-0.251 0.828-0.322 1.71-0.198 2.597 0.366 2.63 2.455 4.723 5.080 5.089 0.282 0.040 0.568 0.060 0.85 0.060 0.599 0 1.184-0.087 1.742-0.257-0.674 2.215-2.642 3.926-4.973 4.21-0.254 0.031-0.51 0.047-0.762 0.047-1.713 0-3.349-0.738-4.486-2.024-1.152-1.304-1.669-2.987-1.457-4.739 0.284-2.335 1.992-4.307 4.204-4.982zM8.985 1c-0.362 0-0.731 0.024-1.104 0.075-3.543 0.48-6.388 3.364-6.82 6.92-0.592 4.867 3.184 9.005 7.924 9.005 0.33 0 0.665-0.020 1.003-0.062 3.549-0.433 6.428-3.283 6.907-6.833 0.052-0.383 0.076-0.761 0.075-1.134-0.002-0.583-0.482-0.972-0.996-0.972-0.209 0-0.424 0.065-0.614 0.207-0.665 0.498-1.489 0.793-2.383 0.793-0.188 0-0.38-0.013-0.574-0.040-1.732-0.242-3.137-1.649-3.378-3.385-0.155-1.115 0.149-2.156 0.751-2.963 0.415-0.657 0.025-1.609-0.764-1.612-0.009 0-0.018 0-0.028 0v0z"></path></symbol> <symbol id="theme-icon-palette" viewBox="0 0 1024 1024"><path d="M745.984 512q25.984 0 45.013333-18.005333t18.986667-45.994667-18.986667-45.994667-45.013333-18.005333-45.013333 18.005333-18.986667 45.994667 18.986667 45.994667 45.013333 18.005333zM617.984 342.016q25.984 0 45.013333-18.986667t18.986667-45.013333-18.986667-45.013333-45.013333-18.986667-45.013333 18.986667-18.986667 45.013333 18.986667 45.013333 45.013333 18.986667zM406.016 342.016q25.984 0 45.013333-18.986667t18.986667-45.013333-18.986667-45.013333-45.013333-18.986667-45.013333 18.986667-18.986667 45.013333 18.986667 45.013333 45.013333 18.986667zM278.016 512q25.984 0 45.013333-18.005333t18.986667-45.994667-18.986667-45.994667-45.013333-18.005333-45.013333 18.005333-18.986667 45.994667 18.986667 45.994667 45.013333 18.005333zM512 128q157.994667 0 271.018667 100.010667t112.981333 242.005333q0 88.021333-63.018667 150.016t-150.997333 61.994667l-73.984 0q-27.989333 0-45.994667 18.986667t-18.005333 45.013333q0 22.016 16 41.984t16 43.989333q0 27.989333-18.005333 45.994667t-45.994667 18.005333q-160 0-272-112t-112-272 112-272 272-112z" p-id="10529"></path></symbol> </svg></div><div class="global-ui"><div class="float-menu-wrap"><!----> <div class="float-menu__list"><span class="icon-up"></span> <span title="auto" class="theme-mode-setting"><svg class="theme-icon theme-icon-auto"><use xlink:href="#theme-icon-auto"></use></svg></span> <!----> <span class="icon-toc"></span> <span class="icon-search"></span></div> <div class="float-menu"><svg width="100%" height="100%" class="float-menu__progress"><circle stroke-dasharray="0% 301.59289474462014%" stroke="currentcolor" stroke-width="2%" fill="none" r="48%" cx="50%" cy="50%"></circle></svg> <div class="float-menu__dot"></div></div></div><div class="theme-search" style="display:none;"><div class="theme-search__inner"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <a class="icon-exit"></a></div></div></div></div>
    <script src="/docs/assets/js/app.90fe924d.js" defer></script><script src="/docs/assets/js/4.2437bced.js" defer></script><script src="/docs/assets/js/12.f6f8b844.js" defer></script><script src="/docs/assets/js/6.b41b8e83.js" defer></script>
  </body>
</html>